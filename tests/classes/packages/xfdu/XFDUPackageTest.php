<?php

require_once dirname(__FILE__) . '/../../../../curation_tool.inc';

/**
 * Test class for XFDUPackage.
 * Generated by PHPUnit on 2012-04-04 at 21:30:36.
 */
class XFDUPackageTest extends PHPUnit_Framework_TestCase {

  /**
   * @var XFDUPackage
   */
  protected $object;

  /**
   * Sets up the fixture, for example, opens a network connection.
   * This method is called before a test is executed.
   */
  protected function setUp() {
    $this->object = new XFDUPackage;
  }

  /**
   * Tears down the fixture, for example, closes a network connection.
   * This method is called after a test is executed.
   */
  protected function tearDown() {
    
  }
  
  /**
   * 
   */
  public function testCreate_package() {
    $settings = new XFDUSetup();
    
    $this->object->create_package($settings);
    
    $document = $this->object->get_document();
    $this->assertEquals('DOMDocument', get_class($document));
    
    $this->assertTrue($document->getElementsByTagName('packageHeader')->length == 1, "length found ".$document->getElementsByTagName('packageHeader')->length);
    $this->assertTrue($document->getElementsByTagName('informationPackageMap')->length == 1);
    $this->assertTrue($document->getElementsByTagName('metadataSection')->length == 1);
    $this->assertTrue($document->getElementsByTagName('dataObjectSection')->length == 1);
    $this->assertTrue($document->getElementsByTagName('behaviorSection')->length == 1);
    ;
  }
  
  /**
   * 
   */
  public function testAddContentUnit() {
    $settings = new XFDUSetup();
    $doID = 'do0';
    $cuID = 'cu0';
    $doID2 = 'do1';
    $cuID2 = 'cu1';    
    $this->object->create_package($settings);
    
    $dataObjectPointer1 = new DataObjectPointer();
    $dataObjectPointer1->set_dataObjectID($doID);
    
    $contentUnit1 = new ContentUnit();
    $contentUnit1->set_id($cuID);
    $contentUnit1->set_dataObjectPointer($dataObjectPointer1);
    
    $this->object->add_element($contentUnit1);
    
    $dataObjectPointer2 = new DataObjectPointer();
    $dataObjectPointer2->set_dataObjectID($doID2);
    
    $contentUnit2 = new ContentUnit();
    $contentUnit2->set_id($cuID2);
    $contentUnit2->set_dataObjectPointer($dataObjectPointer1, $cuID);
    
    $this->object->add_element($contentUnit2, $cuID);
    
    $dom = new DOMDocument('1.0', 'UTF-8');
    $dom = $this->object->get_document();
    
    $xpath = new DOMXPath($dom);
    $query = '//xfdu:contentUnit[@ID="cu1"]';
    $this->assertEquals(1, $xpath->query($query)->length);
    
    
    $query = '//informationPackageMap/xfdu:contentUnit[@ID="cu0"]//xfdu:contentUnit[@ID="cu1"]';
    $this->assertEquals(1, $xpath->query($query)->length);
    
    
  }
  
  /**
   *@expectedException XFDUException 
   */
  public function testAddContentParentInvalidParent() {
    $settings = new XFDUSetup();
    $doID = 'do0';
    $cuID = 'cu0';   
    $this->object->create_package($settings);
    
    $dataObjectPointer1 = new DataObjectPointer();
    $dataObjectPointer1->set_dataObjectID($doID);
    
    $contentUnit1 = new ContentUnit();
    $contentUnit1->set_id($cuID);
    $contentUnit1->set_dataObjectPointer($dataObjectPointer1);
    
    $this->object->add_element($contentUnit1, 'cu3');
  }
  
  /**
   *@expectedException InvalidArgumentException 
   */
  public function testAddInvalidClass() {
    $this->object->add_element(new XFDU());
  }

}

?>
